{
  "WorkItem": {
    "AffectedComponent": {
      "Name": "",
      "DisplayName": ""
    },
    "ClosedComment": "",
    "ClosedDate": null,
    "CommentCount": 5,
    "Custom": null,
    "Description": "I have a few checkboxes in the gui, controlling which objects to show. When changing a checkbox a new graph is created and set through a call to GraphViewModel.Graph. It works a few times before crashing. The animation is awesome :-).\r\n\r\nThis is the stack trace:\r\n\r\nSystem.IndexOutOfRangeException: Index was outside the bounds of the array.\r\n   at GraphSharp.Algorithms.Layout.Simple.Hierarchical.EfficientSugiyamaLayoutAlgorithm`3.Sweeping(Int32 startLayerIndex, Int32 endLayerIndex, Int32 step, Boolean enableSameMeasureOptimization, Boolean& changed, Int32& phase) in d:\\projects\\graphsharp-6e1f3e1fd045\\Source\\Graph#\\Algorithms\\Layout\\Simple\\Hierarchical\\EfficientSugiyamaAlgorithm.DoCrossingMinimizations.cs:line 87\r\n   at GraphSharp.Algorithms.Layout.Simple.Hierarchical.EfficientSugiyamaLayoutAlgorithm`3.DoCrossingMinimizations() in d:\\projects\\graphsharp-6e1f3e1fd045\\Source\\Graph#\\Algorithms\\Layout\\Simple\\Hierarchical\\EfficientSugiyamaAlgorithm.DoCrossingMinimizations.cs:line 58\r\n   at GraphSharp.Algorithms.Layout.Simple.Hierarchical.EfficientSugiyamaLayoutAlgorithm`3.InternalCompute() in d:\\projects\\graphsharp-6e1f3e1fd045\\Source\\Graph#\\Algorithms\\Layout\\Simple\\Hierarchical\\EfficientSugiyamaLayoutAlgorithm.cs:line 111\r\n   at GraphSharp.Algorithms.AlgorithmBase.Compute() in d:\\projects\\graphsharp-6e1f3e1fd045\\Source\\Graph#\\Algorithms\\AlgorithmBase.cs:line 36\r\n   at GraphSharp.Controls.GraphLayout`3.Layout(Boolean continueLayout) in d:\\projects\\graphsharp-6e1f3e1fd045\\Source\\Graph#.Controls\\Controls\\GraphLayout.cs:line 301\r\n   at GraphSharp.Controls.GraphLayout`3.Relayout() in d:\\projects\\graphsharp-6e1f3e1fd045\\Source\\Graph#.Controls\\Controls\\GraphLayout.cs:line 128\r\n   at GraphSharp.Controls.GraphLayout`3.OnRelayoutInduction(Boolean tryKeepControls) in d:\\projects\\graphsharp-6e1f3e1fd045\\Source\\Graph#.Controls\\Controls\\GraphLayout.DependencyProperties.cs:line 396\r\n   at GraphSharp.Controls.GraphLayout`3.Graph_PropertyChanged(DependencyObject obj, DependencyPropertyChangedEventArgs e) in d:\\projects\\graphsharp-6e1f3e1fd045\\Source\\Graph#.Controls\\Controls\\GraphLayout.DependencyProperties.cs:line 384\r\n   at System.Windows.DependencyObject.OnPropertyChanged(DependencyPropertyChangedEventArgs e)\r\n   at System.Windows.FrameworkElement.OnPropertyChanged(DependencyPropertyChangedEventArgs e)\r\n   at System.Windows.DependencyObject.NotifyPropertyChange(DependencyPropertyChangedEventArgs args)\r\n   at System.Windows.DependencyObject.UpdateEffectiveValue(EntryIndex entryIndex, DependencyProperty dp, PropertyMetadata metadata, EffectiveValueEntry oldEntry, EffectiveValueEntry& newEntry, Boolean coerceWithDeferredReference, Boolean coerceWithCurrentValue, OperationType operationType)\r\n   at System.Windows.DependencyObject.InvalidateProperty(DependencyProperty dp)\r\n   at System.Windows.Data.BindingExpressionBase.Invalidate(Boolean isASubPropertyChange)\r\n   at System.Windows.Data.BindingExpression.TransferValue(Object newValue, Boolean isASubPropertyChange)\r\n   at System.Windows.Data.BindingExpression.ScheduleTransfer(Boolean isASubPropertyChange)\r\n   at MS.Internal.Data.ClrBindingWorker.NewValueAvailable(Boolean dependencySourcesChanged, Boolean initialValue, Boolean isASubPropertyChange)\r\n   at MS.Internal.Data.PropertyPathWorker.UpdateSourceValueState(Int32 k, ICollectionView collectionView, Object newValue, Boolean isASubPropertyChange)\r\n   at MS.Internal.Data.ClrBindingWorker.OnSourcePropertyChanged(Object o, String propName)\r\n   at MS.Internal.Data.PropertyPathWorker.System.Windows.IWeakEventListener.ReceiveWeakEvent(Type managerType, Object sender, EventArgs e)\r\n   at System.Windows.WeakEventManager.DeliverEventToList(Object sender, EventArgs args, ListenerList list)\r\n   at System.ComponentModel.PropertyChangedEventManager.OnPropertyChanged(Object sender, PropertyChangedEventArgs args)\r\n   at CmdbScriptEditor.GraphViewModel.NotifyPropertyChanged(String info) in d:\\projects\\CMDB\\CmdbScriptEditor\\GraphViewModel.cs:line 184\r\n   at CmdbScriptEditor.GraphViewModel.set_Graph(GraphModel value) in d:\\projects\\CMDB\\CmdbScriptEditor\\GraphViewModel.cs:line 160\r\n   at CmdbScriptEditor.GraphViewModel.CreateGraphToVisualize() in d:\\projects\\CMDB\\CmdbScriptEditor\\GraphViewModel.cs:line 259\r\n   at CmdbScriptEditor.GraphViewModel.RemoveScriptStatus(String status) in d:\\projects\\CMDB\\CmdbScriptEditor\\GraphViewModel.cs:line 131\r\n   at CmdbScriptEditor.MainWindow.RibbonCheckBox_Unchecked(Object sender, RoutedEventArgs e) in d:\\projects\\CMDB\\CmdbScriptEditor\\MainWindow.xaml.cs:line 70\r\n   at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)\r\n   at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)\r\n   at System.Windows.UIElement.RaiseEventImpl(DependencyObject sender, RoutedEventArgs args)\r\n   at System.Windows.UIElement.RaiseEvent(RoutedEventArgs e)\r\n   at System.Windows.Controls.Primitives.ToggleButton.OnUnchecked(RoutedEventArgs e)\r\n   at System.Windows.Controls.Primitives.ToggleButton.OnIsCheckedChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)\r\n   at System.Windows.DependencyObject.OnPropertyChanged(DependencyPropertyChangedEventArgs e)\r\n   at System.Windows.FrameworkElement.OnPropertyChanged(DependencyPropertyChangedEventArgs e)\r\n   at System.Windows.DependencyObject.NotifyPropertyChange(DependencyPropertyChangedEventArgs args)\r\n   at System.Windows.DependencyObject.UpdateEffectiveValue(EntryIndex entryIndex, DependencyProperty dp, PropertyMetadata metadata, EffectiveValueEntry oldEntry, EffectiveValueEntry& newEntry, Boolean coerceWithDeferredReference, Boolean coerceWithCurrentValue, OperationType operationType)\r\n   at System.Windows.DependencyObject.SetValueCommon(DependencyProperty dp, Object value, PropertyMetadata metadata, Boolean coerceWithDeferredReference, Boolean coerceWithCurrentValue, OperationType operationType, Boolean isInternal)\r\n   at System.Windows.DependencyObject.SetCurrentValueInternal(DependencyProperty dp, Object value)\r\n   at System.Windows.Controls.Primitives.ToggleButton.OnToggle()\r\n   at Microsoft.Windows.Controls.Ribbon.RibbonCheckBox.OnClick() in e:\\dd\\WPFOOB\\src\\wpfoob\\Ribbon\\RibbonControlsLibrary\\Microsoft\\Windows\\Controls\\Ribbon\\RibbonCheckBox.cs:line 509\r\n   at System.Windows.Controls.Primitives.ButtonBase.OnMouseLeftButtonUp(MouseButtonEventArgs e)\r\n   at System.Windows.UIElement.OnMouseLeftButtonUpThunk(Object sender, MouseButtonEventArgs e)\r\n   at System.Windows.Input.MouseButtonEventArgs.InvokeEventHandler(Delegate genericHandler, Object genericTarget)\r\n   at System.Windows.RoutedEventArgs.InvokeHandler(Delegate handler, Object target)\r\n   at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)\r\n   at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)\r\n   at System.Windows.UIElement.ReRaiseEventAs(DependencyObject sender, RoutedEventArgs args, RoutedEvent newEvent)\r\n   at System.Windows.UIElement.OnMouseUpThunk(Object sender, MouseButtonEventArgs e)\r\n   at System.Windows.Input.MouseButtonEventArgs.InvokeEventHandler(Delegate genericHandler, Object genericTarget)\r\n   at System.Windows.RoutedEventArgs.InvokeHandler(Delegate handler, Object target)\r\n   at System.Windows.RoutedEventHandlerInfo.InvokeHandler(Object target, RoutedEventArgs routedEventArgs)\r\n   at System.Windows.EventRoute.InvokeHandlersImpl(Object source, RoutedEventArgs args, Boolean reRaised)\r\n   at System.Windows.UIElement.RaiseEventImpl(DependencyObject sender, RoutedEventArgs args)\r\n   at System.Windows.UIElement.RaiseTrustedEvent(RoutedEventArgs args)\r\n   at System.Windows.UIElement.RaiseEvent(RoutedEventArgs args, Boolean trusted)\r\n   at System.Windows.Input.InputManager.ProcessStagingArea()\r\n   at System.Windows.Input.InputManager.ProcessInput(InputEventArgs input)\r\n   at System.Windows.Input.InputProviderSite.ReportInput(InputReport inputReport)\r\n   at System.Windows.Interop.HwndMouseInputProvider.ReportInput(IntPtr hwnd, InputMode mode, Int32 timestamp, RawMouseActions actions, Int32 x, Int32 y, Int32 wheel)\r\n   at System.Windows.Interop.HwndMouseInputProvider.FilterMessage(IntPtr hwnd, WindowMessage msg, IntPtr wParam, IntPtr lParam, Boolean& handled)\r\n   at System.Windows.Interop.HwndSource.InputFilterMessage(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean& handled)\r\n   at MS.Win32.HwndWrapper.WndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean& handled)\r\n   at MS.Win32.HwndSubclass.DispatcherCallbackOperation(Object o)\r\n   at System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Int32 numArgs)\r\n   at MS.Internal.Threading.ExceptionFilterHelper.TryCatchWhen(Object source, Delegate method, Object args, Int32 numArgs, Delegate catchHandler)\r\n   at System.Windows.Threading.Dispatcher.InvokeImpl(DispatcherPriority priority, TimeSpan timeout, Delegate method, Object args, Int32 numArgs)\r\n   at MS.Win32.HwndSubclass.SubclassWndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam)\r\n   at MS.Win32.UnsafeNativeMethods.DispatchMessage(MSG& msg)\r\n   at System.Windows.Threading.Dispatcher.PushFrameImpl(DispatcherFrame frame)\r\n   at System.Windows.Threading.Dispatcher.PushFrame(DispatcherFrame frame)\r\n   at System.Windows.Application.RunDispatcher(Object ignore)\r\n   at System.Windows.Application.RunInternal(Window window)\r\n   at System.Windows.Application.Run(Window window)\r\n   at System.Windows.Application.Run()\r\n   at CmdbScriptEditor.App.Main() in d:\\projects\\CMDB\\CmdbScriptEditor\\obj\\Debug\\App.g.cs:line 0\r\n",
    "LastUpdatedDate": "2015-02-05T13:55:00.363-08:00",
    "PlannedForRelease": "",
    "ReleaseVisibleToPublic": false,
    "Priority": {
      "Name": "Low",
      "Severity": 50,
      "Id": 1
    },
    "ProjectName": "graphsharp",
    "ReportedDate": "2011-11-14T14:12:24.483-08:00",
    "Status": {
      "Name": "Proposed",
      "Id": 1
    },
    "ReasonClosed": {
      "Name": "Unassigned"
    },
    "Summary": "Index out of range in .EfficientSugiyamaLayoutAlgorithm.Sweeping",
    "Type": {
      "Name": "Issue",
      "Id": 3
    },
    "VoteCount": 6,
    "Id": 8278
  },
  "FileAttachments": [],
  "Comments": [
    {
      "Message": "I am using graphsharp-6e1f3e1fd045 ",
      "PostedDate": "2011-11-14T14:19:04.313-08:00",
      "Id": 48946
    },
    {
      "Message": "Same as #8276",
      "PostedDate": "2011-11-15T01:28:45.467-08:00",
      "Id": 48973
    },
    {
      "Message": "the exception also occurs when creating a graph with only 1 vertex and no edges.\n\nmethod \"Sweeping\" is then called with startLayerIndex = 0 and endLayerIndex = -1.",
      "PostedDate": "2012-04-30T02:04:52.993-07:00",
      "Id": 64018
    },
    {
      "Message": "Here is how I worked around this issue:\n\n        private void ConfigureLayout_(ModelGraphViewerGraph graph)\n        {\n            if (graph == null || graph.VertexCount == 0)\n            {\n                graphLayout_.LayoutAlgorithmType = null;\n                return;\n            }\n\n            if (graph.EdgeCount == 0 || graph.VertexCount <= 1)\n            {\n                graphLayout_.LayoutAlgorithmType = \"CompoundFDP\";\n            }\n            else\n            {\n                graphLayout_.LayoutAlgorithmType = \"EfficientSugiyama\";\n            }\n        }\n\nThe idea is to use a different graph layout when the graph is problematic. Fortunately, the problematic graphs are trivial so the layout change is smooth. You should call the method right after the graph is modified to refresh the layout. When setting the EfficientSugiyama layout you may want to set the layout parameters. For example:\n\n    var layoutParams = graphLayout_.LayoutParameters as \n        GraphSharp.Algorithms.Layout.Simple.Hierarchical.EfficientSugiyamaLayoutParameters;\n    layoutParams.LayerDistance = 25;\n    layoutParams.VertexDistance = 25;\n    layoutParams.MinimizeEdgeLength = false;\n",
      "PostedDate": "2012-10-03T02:37:44.77-07:00",
      "Id": 78388
    },
    {
      "Message": "@adamcarmi, thank you. Your suggestion fixes this bug.",
      "PostedDate": "2015-02-05T13:55:00.363-08:00",
      "Id": 173577
    }
  ]
}